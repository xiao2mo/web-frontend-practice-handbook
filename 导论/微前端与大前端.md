[![è¿”å›ç›®å½•](https://parg.co/U0y)](https://parg.co/UHU)

# å¾®å‰ç«¯ä¸å¤§å‰ç«¯

> ğŸ— æœ¬æ–‡èŠ‚é€‰è‡ª [Web å¼€å‘å¯¼è®º/å¾®å‰ç«¯ä¸å¤§å‰ç«¯](https://parg.co/oyv)ï¼Œç€çœ¼é˜è¿°äº†å¾®æœåŠ¡ä¸å¾®å‰ç«¯çš„è®¾è®¡ç†å¿µä»¥åŠå¾®å‰ç«¯çš„æ½œåœ¨å¯è¡Œæ–¹æ¡ˆï¼Œéœ€è¦è‡´æ•¬çš„æ˜¯ï¼Œæœ¬æ–‡çš„å¾ˆå¤šè€ƒè™‘å€Ÿé‰´äº† [Phodal å…³äºå¾®å‰ç«¯çš„ç³»åˆ—è®¨è®º](https://www.phodal.com/blog)ä»¥åŠ [Web Architecture Links](https://parg.co/oym) ä¸­å£°æ˜çš„å…¶ä»–æ–‡ç« ï¼Œæ­¤å¤–ç»“åˆäº†è‡ªå·±æµ…è–„çš„è€ƒé‡ä¸å®è·µä½“æ‚Ÿï¼Œæ¡†æ¶ä»£ç å¯ä»¥å‚é˜… [Ueact/micro-frontend](https://github.com/wxyyxc1992/Ueact)ã€‚

# å¾®å‰ç«¯

å¾®æœåŠ¡ä¸å¾®å‰ç«¯ï¼Œéƒ½æ˜¯å¸Œæœ›å°†æŸä¸ªå•ä¸€çš„å•ä½“åº”ç”¨ï¼Œè½¬åŒ–ä¸ºå¤šä¸ªå¯ä»¥ç‹¬ç«‹è¿è¡Œã€ç‹¬ç«‹å¼€å‘ã€ç‹¬ç«‹éƒ¨ç½²ã€ç‹¬ç«‹ç»´æŠ¤çš„æœåŠ¡æˆ–è€…åº”ç”¨çš„èšåˆï¼Œä»è€Œæ»¡è¶³ä¸šåŠ¡å¿«é€Ÿå˜åŒ–åŠåˆ†å¸ƒå¼å¤šå›¢é˜Ÿå¹¶è¡Œå¼€å‘çš„éœ€æ±‚ã€‚å¦‚åº·å¨å®šå¾‹(Conwayâ€™s Law)æ‰€è¨€ï¼Œè®¾è®¡ç³»ç»Ÿçš„ç»„ç»‡ï¼Œå…¶äº§ç”Ÿçš„è®¾è®¡å’Œæ¶æ„ç­‰ä»·äºç»„ç»‡é—´çš„æ²Ÿé€šç»“æ„ï¼›å¾®æœåŠ¡ä¸å¾®å‰ç«¯ä¸ä»…ä»…æ˜¯æŠ€æœ¯æ¶æ„çš„å˜åŒ–ï¼Œè¿˜åŒ…å«äº†ç»„ç»‡æ–¹å¼ã€æ²Ÿé€šæ–¹å¼çš„å˜åŒ–ã€‚å¾®æœåŠ¡ä¸å¾®å‰ç«¯åŸç†å’Œè½¯ä»¶å·¥ç¨‹ï¼Œé¢å‘å¯¹è±¡è®¾è®¡ä¸­çš„åŸç†åŒæ ·ç›¸é€šï¼Œéƒ½æ˜¯éµå¾ªå•ä¸€èŒè´£(Single Responsibility)ã€å…³æ³¨åˆ†ç¦»(Separation of Concerns)ã€æ¨¡å—åŒ–(Modularity)ä¸åˆ†è€Œæ²»ä¹‹(Divide & Conquer)ç­‰åŸºæœ¬çš„åŸåˆ™ã€‚

![image](https://user-images.githubusercontent.com/5803001/44003132-9ecc01b2-9e80-11e8-9418-a98cddac88d7.png)

åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œå¾®å‰ç«¯ä¹ŸåŒ…å«äº†å¯¹äºç³»ç»Ÿçš„çºµå‘åˆ‡åˆ†ï¼›å³ä¸åŒçš„å›¢é˜Ÿä¼šè´Ÿè´£ç³»ç»Ÿä¸­æŸä¸ªç‰¹æ€§/æ¨¡å—ï¼Œä»æ•°æ®åº“ã€æœåŠ¡ç«¯åˆ°ç”¨æˆ·ç•Œé¢å®Œæ•´çš„æµçº¿ã€‚æ¯ä¸ªå›¢é˜Ÿä¼šæ›´å¤šåœ°ç€çœ¼äºä¸šåŠ¡æ¨¡å‹ä¸ç‰¹ç‚¹ã€‚ç‹¬ç«‹å¹¶ä¸æ„å‘³ç€å®Œå…¨çš„åˆ‡å‰²ï¼Œå„ä¸ªç‰¹æ€§/æ¨¡å—ä¹‹é—´çš„å…±ç°ç»„ä»¶å¯ä»¥é€šè¿‡ NPM/Git Submodule ç­‰æ–¹å¼è¿›è¡ŒååŒå¼€å‘ä¸å¤ç”¨ã€‚å¾®å‰ç«¯çš„è½åœ°ï¼Œéœ€è¦è€ƒè™‘åˆ°äº§å“ç ”å‘ä¸å‘å¸ƒçš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸï¼›æˆ‘ä»¬ä¼šå…³æ³¨å¦‚ä½•ä¿è¯å„ä¸ªå›¢é˜Ÿçš„ç‹¬ç«‹å¼€å‘ä¸çµæ´»çš„æŠ€æœ¯æ ˆé€‰é…ï¼Œå¦‚ä½•ä¿è¯ä»£ç é£æ ¼ã€ä»£ç è§„èŒƒçš„ä¸€è‡´æ€§ï¼Œå¦‚ä½•åˆå¹¶å¤šä¸ªç‹¬ç«‹çš„å‰ç«¯åº”ç”¨ï¼Œå¦‚ä½•åœ¨è¿è¡Œæ—¶å¯¹å¤šä¸ªåº”ç”¨è¿›è¡Œæœ‰æ•ˆæ²»ç†ï¼Œå¦‚ä½•ä¿éšœå¤šåº”ç”¨çš„ä½“éªŒä¸€è‡´æ€§ï¼Œå¦‚ä½•ä¿éšœä¸ªåº”ç”¨çš„å¯æµ‹è¯•ä¸å¯ä¾èµ–æ€§ç­‰æ–¹é¢ã€‚å…·ä½“è€Œè¨€ï¼Œæˆ‘ä»¬å¯èƒ½ä»åº”ç”¨ç»„åˆã€åº”ç”¨éš”ç¦»ã€åº”ç”¨åè°ƒä¸æ²»ç†ã€å¼€å‘ç¯å¢ƒç­‰å‡ ä¸ªæ–¹é¢è¿›è¡Œè€ƒè™‘ï¼š

- åº”ç”¨ç»„åˆ:

  - ç»„åˆæ—¶æœºï¼Œåœ¨æ„å»ºæ—¶ç»„åˆï¼Œè¿˜æ˜¯åœ¨è¿è¡Œæ—¶ç»„åˆ
  - åº”ç”¨è·¯ç”±ï¼Œå¦‚ä½•æ ¹æ® URL åŠ è½½/å¯¼èˆªåˆ°ä¸åŒçš„é¡µé¢ï¼Œå¦‚ä½•æ ¹æ®å­åº”ç”¨ç•Œé¢çš„å˜åŒ–åˆ‡æ¢ URL
  - åº”ç”¨åŠ è½½ï¼Œç¡®å®šåŠ è½½åº”ç”¨çš„ç‰ˆæœ¬ï¼Œä¾èµ–äºæ¡†æ¶çš„åŠ è½½æœºåˆ¶ï¼Œè¿˜æ˜¯é‡‡ç”¨ AMD æˆ–è€… SystemJS å¼‚æ­¥åŠ è½½

* åº”ç”¨éš”ç¦»:

  - åº”ç”¨å®¹é”™ï¼ŒæŸä¸ªåº”ç”¨çš„å´©æºƒä¸åº”å½±å“åˆ°å…¶ä»–åº”ç”¨æˆ–å®¹å™¨åº”ç”¨ï¼›
  - æ ·å¼éš”ç¦»ï¼Œé¿å… CSS ç›¸äº’æ±¡æŸ“
  - DOM éš”ç¦»ï¼Œé¿å…å­åº”ç”¨æ“ä½œéè‡ªèº«ä½œç”¨åŸŸå†…çš„ç»“ç‚¹

* åº”ç”¨åè°ƒä¸æ²»ç†ï¼š

  - ç»Ÿä¸€é…ç½®ä¸åˆ‡æ¢ï¼Œä¸»é¢˜ï¼Œåˆ©ç”¨ CSS Variables ç­‰æ–¹å¼åŠ¨æ€æ¢è‚¤
  - åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸï¼Œè§„èŒƒåŒ–å­åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¹¶ä¸”åœ¨ä¸åŒç”Ÿå‘½å‘¨æœŸä¸­æ‰§è¡Œä¸åŒçš„æ“ä½œ
  - æ•°æ®å…±äº«ï¼Œå­åº”ç”¨é—´æ•°æ®å…±äº«
  - æœåŠ¡å…±äº«ï¼Œè·¨åº”ç”¨æ•°æ®å…±äº«ä¸æœåŠ¡è°ƒç”¨
  - ç»„ä»¶å…±äº«ï¼Œå¯èƒ½å°†æŸä¸ªçº¯ç•Œé¢ç»„ä»¶æˆ–è€…ä¸šåŠ¡ç»„ä»¶ä»¥æ’ä»¶(Plugin)æˆ–è€…éƒ¨ä»¶(Widget)çš„æ–¹å¼å…±äº«å‡ºå»ï¼›æä¾›æŸä¸ªè®¡ç®—èƒ½åŠ›ã€‚

* å¼€å‘ç¯å¢ƒï¼š

  - è·¨æŠ€æœ¯æ ˆæ”¯æŒ
  - ç»Ÿä¸€çš„æ„å»ºæµç¨‹ä¸è§„èŒƒ
  - æ‰“æ¡©ã€åŸ‹ç‚¹ä¸ Hijack

æ­¤å¤–å€¼å¾—ä¸€æçš„æ˜¯ï¼Œå¾®å‰ç«¯åŒ–æœ¬èº«æ˜¯ä¸ºäº†ä¿è¯ç³»ç»Ÿçš„æŒç»­é›†æˆä¸å¿«é€Ÿè¿­ä»£ï¼Œé‚£ä¹ˆå¯¹äºå„ä¸ªå­æ¨¡å—ä¸ç³»ç»Ÿæœ¬èº«çš„å¯ç”¨æ€§ä¸ç¨³å®šæ€§åŠ¿å¿…ä¼šå¸¦æ¥æŒ‘æˆ˜ï¼Œè¿™å°±è¦æ±‚æˆ‘ä»¬åœ¨è®¾è®¡å¾®å‰ç«¯è§£å†³æ–¹æ¡ˆæ—¶ï¼Œè€ƒè™‘æŒç»­æ„å»ºçš„æ—¶æœºä¸å¯¹åº”çš„æµ‹è¯•æ–¹æ¡ˆï¼›é™¤äº†æ ‡å‡†çš„å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€ç«¯åˆ°ç«¯æµ‹è¯•ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¿è¯æ¨¡å—çš„ä¾èµ–ä¸€è‡´æ€§ä¸åŠŸèƒ½æ¨¡å—çš„å¯ç”Ÿæˆæ€§ï¼›å…³äºæ­¤éƒ¨åˆ†çš„è¯¦ç»†è®¨è®ºå‚é˜… [Web è‡ªåŠ¨åŒ–æµ‹è¯•æ¦‚è¿°](https://parg.co/oyu)ã€‚

## å¾®æœåŠ¡

> ğŸ“š æ›´å¤šå…³äºå¾®æœåŠ¡çš„è®¨è®ºå‚è€ƒ[å¾®æœåŠ¡ç†å¿µã€æ¶æ„ä¸å®è·µé€Ÿè§ˆ](https://parg.co/oVN)

å¾®æœåŠ¡æ˜¯ä¸€ä¸ªç®€å•è€Œæ³›åŒ–çš„æ¦‚å¿µï¼Œä¸åŒçš„è¡Œä¸šé¢†åŸŸã€æŠ€æœ¯èƒŒæ™¯ã€ä¸šåŠ¡æ¶æ„å¯¹äºå¾®æœåŠ¡çš„ç†è§£ä¸å®è·µä¹Ÿæ˜¯ä¸ä¸€è‡´çš„ã€‚ä¸å¾®æœåŠ¡ç›¸å¯¹çš„ï¼Œå³æ˜¯å•ä½“æ¶æ„çš„å·¨çŸ³å‹(Monolithic)åº”ç”¨ï¼Œå…¸å‹çš„å³æ˜¯å°†æ‰€æœ‰åŠŸèƒ½éƒ½éƒ¨ç½²åœ¨ä¸€ä¸ª Web å®¹å™¨ä¸­è¿è¡Œçš„ç³»ç»Ÿã€‚è™½ç„¶å¾ˆå¤šçš„æ–‡ç« å¯¹äºå·¨çŸ³å‹åº”ç”¨é¢‡å¤šè¯Ÿç—…ï¼Œä½†å¹¶ä¸æ„å‘³ç€å…¶å°±çœŸçš„ä¸€æ— æ˜¯å¤„ï¼Œæ¯•ç«Ÿå¾®æœåŠ¡æœ¬èº«ä¹Ÿæ˜¯æœ‰ä»£ä»·çš„ã€‚é™¤äº†ç»„ç»‡çš„ç»“æ„ä¹‹å¤–ï¼Œå¾®æœåŠ¡å¾€å¾€è¿˜è¦æ±‚ç»„ç»‡å…·å¤‡å¿«é€Ÿçš„ç¯å¢ƒæä¾›(Rapid Provisioning)ä¸äº‘å¼€å‘ã€åŸºæœ¬çš„ç›‘æ§(Basic Monitoring)ã€å¿«é€Ÿçš„åº”ç”¨å‘å¸ƒ(Rapid Application Deployment)ã€DevOps ç­‰èƒ½åŠ›ã€‚

![image](https://user-images.githubusercontent.com/5803001/43848094-c9c506c6-9b64-11e8-9658-62066098ce86.png)

å¾®æœåŠ¡åº”ç”¨å¾€å¾€ç”±å¤šä¸ªç²’åº¦è¾ƒå°ï¼Œç‰ˆæœ¬ç‹¬ç«‹ï¼Œæœ‰æ˜ç¡®è¾¹ç•Œå¹¶å¯æ‰©å±•çš„æœåŠ¡æ„æˆï¼Œå„ä¸ªæœåŠ¡ä¹‹é—´é€šè¿‡å®šä¹‰å¥½çš„æ ‡å‡†åè®®ç›¸äº’é€šä¿¡ã€‚åœ¨æ„å»ºå¾®æœåŠ¡æ¶æ„æ—¶ï¼Œæ¨¡å—åŒ–(Modularity)å’Œåˆ†è€Œæ²»ä¹‹(Divide & Conquer)æ˜¯åŸºæœ¬çš„æ€è·¯ã€‚ç„¶åéœ€è¦è€ƒè™‘å•ä¸€èŒè´£(Single Responsibility)åŸåˆ™ï¼Œå³ä¸€ä¸ªæœåŠ¡åº”å½“æ‰¿æ‹…å°½å¯èƒ½å•ä¸€çš„èŒè´£ï¼ŒæœåŠ¡åº”åŸºäºæœ‰ç•Œçš„ä¸Šä¸‹æ–‡(Bounded Context)ï¼Œé€šå¸¸æ˜¯è¾¹ç•Œæ¸…æ™°çš„ä¸šåŠ¡é¢†åŸŸæ„å»ºã€‚ä»ç³»ç»Ÿè¡åŒ–çš„è§’åº¦ï¼Œåœ¨ç³»ç»Ÿæ—©æœŸæµé‡è¾ƒå°‘æ—¶ï¼Œåªéœ€ä¸€ä¸ªåº”ç”¨å°†æ‰€æœ‰åŠŸèƒ½éƒ½éƒ¨ç½²åœ¨ä¸€èµ·ï¼Œä»¥å‡å°‘éƒ¨ç½²èŠ‚ç‚¹å’Œæˆæœ¬ã€‚éšç€æµé‡é€æ­¥å¢å¤§ï¼Œæˆ‘ä»¬è¿‡æ¸¡ä¸ºäº†åŒ…å«å¤šä¸ªç›¸äº’éš”ç¦»åº”ç”¨çš„å‚ç›´åº”ç”¨æ¶æ„ï¼›å³æ˜¯å°†ä¸åŒèŒèƒ½çš„æ¨¡å—åˆ†æˆä¸åŒçš„æœåŠ¡ï¼Œä¹Ÿé€æ­¥å¼€å§‹äº†å¾®æœåŠ¡åŒ–çš„æ­¥ä¼ã€‚æ¥ä¸‹æ¥ï¼Œéšç€å‚ç›´åº”ç”¨è¶Šæ¥è¶Šå¤šï¼Œåº”ç”¨ä¹‹é—´äº¤äº’ä¸å¯é¿å…ï¼Œå°†æ ¸å¿ƒä¸šåŠ¡æŠ½å–å‡ºæ¥ï¼Œä½œä¸ºç‹¬ç«‹çš„æœåŠ¡ï¼Œé€æ¸å½¢æˆç¨³å®šçš„æœåŠ¡ä¸­å°ã€‚

åŸºäºè¿™äº›æ€è€ƒï¼Œæˆ‘ä»¬å¯ä»¥å°†å¾®æœåŠ¡ä¸­çš„æŒ‘æˆ˜ä¸å…³æ³¨ç‚¹ï¼Œåˆ’åˆ†ä¸ºä»¥ä¸‹æ–¹é¢ï¼š

> ğŸ“– å›¾ç‰‡æºäº [Awesome-MindMap/MicroService-MindMap](https://parg.co/oVf)

[![microservice](https://user-images.githubusercontent.com/5803001/36406479-25dcddf2-1632-11e8-91a3-2db79aaf7492.png)
](https://www.processon.com/view/link/5a8b974ae4b059c41ac40e07)

# æµè§ˆå™¨ç¡¬éš”ç¦»

ç»„åˆä¸éš”ç¦»ï¼Œæœ¬å°±æ˜¯ä¸€ä½“ä¸¤é¢ï¼Œå¾€å¾€æŸç§ç»„åˆæ–¹æ¡ˆå°±è‡ªç„¶è§£å†³äº†éš”ç¦»çš„ç—›ç‚¹ï¼Œè€ŒæŸç§éš”ç¦»æ–¹æ¡ˆåˆä¼šé™åˆ¶ç»„åˆçš„æ–¹å¼ã€‚ç¬”è€…é¦–å…ˆä»ç¡¬/è½¯éš”ç¦»çš„è§’åº¦æ¥å¯¹æ–¹æ¡ˆè¿›è¡Œåˆ†ç±»ï¼ŒæœåŠ¡ç«¯è·¯ç”±åˆ†å‘ä¸ iFrame æ˜¯å…¸å‹çš„åŸºäºæµè§ˆå™¨çš„ç¡¬éš”ç¦»æ–¹æ¡ˆï¼Œå…¶å¤©ç„¶æ”¯æŒå¤šæŠ€æœ¯æ ˆã€å¤šæºçš„çµæ´»ç»„åˆï¼Œä¸è¿‡å…¶åœ¨åº”ç”¨åè°ƒä¸æ²»ç†æ–¹é¢éœ€è¦æŠ•å…¥è¾ƒå¤§çš„ç²¾åŠ›ã€‚Web Components åŠå…¶è¡ç”Ÿæ–¹æ¡ˆåŒæ ·èƒ½å¸¦æ¥æµè§ˆå™¨çº§åˆ«çš„éš”ç¦»ä¸æ¾æ•£çš„åº”ç”¨åè°ƒï¼Œä½†æ˜¯è¾ƒå·®çš„æµè§ˆå™¨å…¼å®¹æ€§ä¹Ÿé™åˆ¶äº†å…¶åº”ç”¨åœºæ™¯ã€‚

## iFrame

iFrame å¯ä»¥åˆ›å»ºä¸€ä¸ªå…¨æ–°çš„ç‹¬ç«‹çš„å®¿ä¸»ç¯å¢ƒï¼ŒiFrame çš„é¡µé¢å’Œçˆ¶é¡µé¢æ˜¯åˆ†å¼€çš„ï¼Œä½œä¸ºç‹¬ç«‹åŒºåŸŸè€Œä¸å—çˆ¶é¡µé¢çš„ CSS æˆ–è€…å…¨å±€çš„ JavaScript å½±å“ã€‚iFrame çš„ä¸è¶³æˆ–ç¼ºé™·ä¹Ÿéå¸¸æ˜æ˜¾ï¼Œå…¶ä¼šè¿›è¡Œèµ„æºçš„é‡å¤åŠ è½½ï¼Œå ç”¨é¢å¤–çš„å†…å­˜ï¼›å…¶ä¼šé˜»å¡ä¸»é¡µé¢çš„ onload äº‹ä»¶ï¼Œå’Œä¸»é¡µé¢å…±äº«è¿æ¥æ± ï¼Œè€Œæµè§ˆå™¨å¯¹ç›¸åŒåŸŸçš„è¿æ¥æœ‰é™åˆ¶ï¼Œæ‰€ä»¥ä¼šå½±å“é¡µé¢çš„å¹¶è¡ŒåŠ è½½ã€‚

iFrame çš„æ”¹é€ é—¨æ§›è¾ƒä½ï¼Œä½†æ˜¯ä»åŠŸèƒ½éœ€æ±‚çš„è§’åº¦çœ‹ï¼Œå…¶æ— æ³•æä¾› SEOï¼Œå¹¶ä¸”éœ€è¦æˆ‘ä»¬è‡ªå®šä¹‰åº”ç”¨ç®¡ç†ä¸åº”ç”¨é€šè®¯æœºåˆ¶ã€‚iFrame çš„åº”ç”¨ç®¡ç†ä¸ä»…è¦å…³æ³¨å…¶åŠ è½½ä¸ç”Ÿå‘½å‘¨æœŸï¼Œè¿˜éœ€è¦è€ƒè™‘åˆ°æµè§ˆå™¨ç¼©æ”¾ç­‰åœºæ™¯ä¸‹çš„ç•Œé¢é‡é€‚é…é—®é¢˜ï¼Œä»¥æä¾›ç”¨æˆ·ä¸€è‡´çš„äº¤äº’ä½“éªŒï¼›è¿™é‡Œæˆ‘ä»¬å†ç®€è¦è®¨è®ºä¸‹åŒæºåœºæ™¯ä¸­çš„è·¨ç•Œé¢é€šè®¯è§£å†³æ–¹æ¡ˆã€‚

> ğŸ“– è¯¦ç»†è§£è¯»å‚é˜… [DOM CheatSheet](https://parg.co/YlB)

- BroadcastChannel

BroadcastChannel èƒ½å¤Ÿç”¨äºåŒæºä¸åŒé¡µé¢ä¹‹é—´å®Œæˆé€šä¿¡çš„åŠŸèƒ½ã€‚å®ƒä¸ window.postMessage çš„åŒºåˆ«å°±æ˜¯ï¼ŒBroadcastChannel åªèƒ½ç”¨äºåŒæºçš„é¡µé¢ä¹‹é—´è¿›è¡Œé€šä¿¡ï¼Œè€Œ window.postMessage å´å¯ä»¥ç”¨äºä»»ä½•çš„é¡µé¢ä¹‹é—´ï¼›BroadcastChannel å¯ä»¥è®¤ä¸ºæ˜¯ window.postMessage çš„ä¸€ä¸ªå®ä¾‹ï¼Œå®ƒæ‰¿æ‹…äº† window.postMessage çš„ä¸€ä¸ªæ–¹é¢çš„åŠŸèƒ½ã€‚

```js
const channel = new BroadcastChannel('channel-name');

channel.postMessage('some message');
channel.postMessage({ key: 'value' });

channel.onmessage = function(e) {
  const message = e.data;
};

channel.close();
```

- SharedWorker API

Shared Worker ç±»ä¼¼äº Web Workersï¼Œä¸è¿‡å…¶ä¼šè¢«æ¥è‡ªåŒæºçš„ä¸åŒæµè§ˆä¸Šä¸‹æ–‡é—´å…±äº«ï¼Œå› æ­¤ä¹Ÿå¯ä»¥ç”¨ä½œæ¶ˆæ¯çš„ä¸­è½¬ç«™ã€‚

```js
// main.js
const worker = new SharedWorker('shared-worker.js');

worker.port.postMessage('some message');

worker.port.onmessage = function(e) {
  const message = e.data;
};

// shared-worker.js
const connections = [];

onconnect = function(e) {
  const port = e.ports[0];
  connections.push(port);
};

onmessage = function(e) {
  connections.forEach(function(connection) {
    if (connection !== port) {
      connection.postMessage(e.data);
    }
  });
};
```

- Local Storage

localStorage æ˜¯å¸¸è§çš„æŒä¹…åŒ–åŒæºå­˜å‚¨æœºåˆ¶ï¼Œå…¶ä¼šåœ¨å†…å®¹å˜åŒ–æ—¶è§¦å‘äº‹ä»¶ï¼Œä¹Ÿå°±å¯ä»¥ç”¨ä½œåŒæºç•Œé¢çš„æ•°æ®é€šä¿¡ã€‚

```js
localStorage.setItem('key', 'value');

window.onstorage = function(e) {
  const message = e.newValue; // previous value at e.oldValue
};
```

## Web Components && Shadow DOM

Web Components çš„ç›®æ ‡æ˜¯å‡å°‘å•é¡µåº”ç”¨ä¸­éš”ç¦» HTMLï¼ŒCSS ä¸ JavaScript çš„å¤æ‚åº¦ï¼Œå…¶ä¸»è¦åŒ…å«äº† Custom Elements, Shadow DOM, Template Elementï¼ŒHTML Importsï¼ŒCustom Properties ç­‰å¤šä¸ªç»´åº¦çš„è§„èŒƒä¸å®ç°ã€‚Shadow DOM å®ƒå…è®¸åœ¨æ–‡æ¡£ï¼ˆdocumentï¼‰æ¸²æŸ“æ—¶æ’å…¥ä¸€æ£µ DOM å…ƒç´ å­æ ‘ï¼Œä½†æ˜¯è¿™æ£µå­æ ‘ä¸åœ¨ä¸» DOM æ ‘ä¸­ã€‚å› æ­¤å¼€å‘è€…å¯åˆ©ç”¨ Shadow DOM å°è£…è‡ªå·±çš„ HTML æ ‡ç­¾ã€CSS æ ·å¼å’Œ JavaScript ä»£ç ã€‚å­æ ‘ä¹‹é—´å¯ä»¥ç›¸äº’åµŒå¥—ï¼Œå¯¹å…¶ä¸­çš„å†…å®¹è¿›è¡Œäº†å°è£…ï¼Œæœ‰é€‰æ‹©æ€§çš„è¿›è¡Œæ¸²æŸ“ã€‚è¿™å°±æ„å‘³ç€æˆ‘ä»¬å¯ä»¥æ’å…¥æ–‡æœ¬ã€é‡æ–°å®‰æ’å†…å®¹ã€æ·»åŠ æ ·å¼ç­‰ç­‰ã€‚å…¶ç»“æ„ç¤ºæ„å¦‚ä¸‹ï¼š

![image](https://user-images.githubusercontent.com/5803001/43813782-c17e5d34-9af9-11e8-94df-7974298a2afc.png)

ç®€å•çš„ Shadow DOM åˆ›å»ºæ–¹å¼å¦‚ä¸‹ï¼š

```html
<html>
  <head></head>
  <body>
    <p id="hostElement"></p>
    <script>
      // åˆ›å»º shadow DOM
      var shadow = document
        .querySelector('#hostElement')
        .attachShadow({ mode: 'open' });
      // ç»™ shadow DOM æ·»åŠ æ–‡å­—
      shadow.innerHTML = '<p>Here is some new text</p>';
      // æ·»åŠ CSSï¼Œå°†æ–‡å­—å˜çº¢
      shadow.innerHTML += '<style>p { color: red; }</style>';
    </script>
  </body>
</html>
```

æˆ‘ä»¬ä¹Ÿå¯ä»¥å°† React åº”ç”¨å°è£…ä¸º Custom Element å¹¶ä¸”å°è£…åˆ° Shadow DOM ä¸­ï¼š

```js
import React from 'react';
import retargetEvents from 'react-shadow-dom-retarget-events';

class App extends React.Component {
  render() {
    return <div onClick={() => alert('I have been clicked')}>Click me</div>;
  }
}

const proto = Object.create(HTMLElement.prototype, {
  attachedCallback: {
    value: function() {
      const mountPoint = document.createElement('span');
      const shadowRoot = this.createShadowRoot();
      shadowRoot.appendChild(mountPoint);
      ReactDOM.render(<App />, mountPoint);
      retargetEvents(shadowRoot);
    }
  }
});
document.registerElement('my-custom-element', { prototype: proto });
```

Shadow DOM çš„å…¼å®¹æ€§è¾ƒå·®ï¼Œä»…åœ¨ Chrome è¾ƒé«˜ç‰ˆæœ¬æµè§ˆå™¨ä¸­å¯ä»¥ä½¿ç”¨ã€‚

# å•ä½“åº”ç”¨è½¯éš”ç¦»

ä¸ç¡¬éš”ç¦»ç›¸å¯¹çš„ï¼Œç¬”è€…ç§°ä¸ºå•ä½“åº”ç”¨è½¯éš”ç¦»ï¼Œå…¶æ›´å¤šåœ°ä¾èµ–äºåº”ç”¨æ¡†æ¶æˆ–è€…å¼€å‘æ„å»ºæµç¨‹ï¼Œæ¥å®ç°å®¹é”™ä¸æ ·å¼ã€DOM ç­‰éš”ç¦»ã€‚å•ä½“åº”ç”¨è½¯éš”ç¦»åˆå¯ä»¥ä»åº”ç”¨çš„ç»„åˆæ—¶æœºä¸æŠ€æœ¯æ ˆçš„æ”¯æŒæƒ…å†µè¿™ä¸¤ä¸ªç»´åº¦ï¼Œåˆ’åˆ†ä¸åŒçš„è§£å†³æ–¹æ¡ˆã€‚å¯¹äºéœ€è¦æ”¯æŒä¸åŒæŠ€æœ¯æ ˆ(React, Angular, Vue.js, etc.)çš„åœºæ™¯ï¼Œæˆ‘ä»¬å¾€å¾€éœ€è¦å½»åº•çš„ç±»åç«¯å¾®æœåŠ¡åŒ–ï¼Œæ¯ä¸ªå‰ç«¯åº”ç”¨éƒ½æ˜¯ç‹¬ç«‹çš„æœåŠ¡åŒ–åº”ç”¨ï¼Œè€Œå®¿ä¸»åº”ç”¨åˆ™æä¾›ç»Ÿä¸€çš„åº”ç”¨ç®¡ç†å’Œå¯åŠ¨æœºåˆ¶ï¼›æ­¤æ—¶è‹¥éœ€è¦è§£å†³èµ„æºé‡å¤åŠ è½½ã€å†—ä½™çš„é—®é¢˜ï¼Œåˆ™éœ€è¦ä¾èµ–ç»Ÿä¸€æ„å»ºæˆ–è€…ç”±å®¿ä¸»åº”ç”¨æä¾›å…¬å…±ä¾èµ–åº“ï¼Œå­åº”ç”¨æ‰“åŒ…æ—¶ä»…æ‰“åŒ…è‡ªèº«æˆ–éå…¬ç”¨åº“ä»£ç ã€‚å¦‚æœæ˜¯ç›¸åŒæŠ€æœ¯æ ˆçš„åœºæ™¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ–¹ä¾¿åœ°åˆ©ç”¨æ¡†æ¶æœ¬èº«çš„æ‡’åŠ è½½èƒ½åŠ›ï¼Œåœ¨å¼€å‘é˜¶æ®µä»¥æ¨¡å—åˆ’åˆ†ä¸ºå¾®åº”ç”¨è¿›è¡Œå¼€å‘ï¼Œæ„å»ºæ—¶ä»¥å•ä½“åº”ç”¨çš„å½¢å¼æ„å»ºï¼Œåœ¨è¿è¡Œæ—¶æ˜¯ä»¥åº”ç”¨æ¨¡å—çš„å½¢å¼å­˜åœ¨ã€‚

![image](https://user-images.githubusercontent.com/5803001/44003230-de68ac5c-9e81-11e8-81f5-8092f7a9b421.png)

> ğŸ“Œ æœ¬éƒ¨åˆ†ä¼šéšç€ç¬”è€…çš„å®è·µé€æ­¥å®Œå–„ä¸°å¯Œï¼Œå¯ä»¥ä¿æŒå…³æ³¨ [Web å¼€å‘å¯¼è®º](https://github.com/wxyyxc1992/Web-Series) æˆ–è€… [Ueact](https://github.com/wxyyxc1992/Ueact)ã€‚

## Application Composition | åº”ç”¨ç»„åˆ

å…¸å‹çš„åº”ç”¨ç»„åˆæ–¹å¼åˆ†ä¸ºæ„å»ºæ—¶(Build Time)ç»„åˆä¸è¿è¡Œæ—¶(Runtime)ç»„åˆï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºå³æ˜¯å…¸å‹çš„æ„å»ºæ—¶ç»„åˆæ–¹æ¡ˆï¼š

> ğŸ— å›¾ç‰‡æºè‡ª [Building application in a "Microfrontends" way](https://parg.co/o32)

![image](https://user-images.githubusercontent.com/5803001/43635855-fa36c57c-9742-11e8-80b4-71eda09bb20b.png)

æ„å»ºæ—¶ç»„åˆçš„ä¼˜åŠ¿åœ¨äºèƒ½å¤Ÿè¿›è¡Œè¾ƒå¥½åœ°ä¾èµ–ç®¡ç†ï¼ŒæŠ½å–å…¬å…±æ¨¡å—ï¼Œå‡å°‘æœ€ç»ˆçš„åŒ…ä½“å¤§å°ï¼Œä¸è¿‡å…¶æœ€ç»ˆçš„äº§å‡ºä»æ˜¯å•ä½“åº”ç”¨ï¼Œå„ä¸ªåº”ç”¨æ¨¡å—æ— æ³•è¿›è¡Œç‹¬ç«‹éƒ¨ç½²ã€‚ä¸ä¹‹ç›¸å¯¹çš„ï¼Œè¿è¡Œæ—¶ç»„åˆèƒ½å¤Ÿä¿éšœçœŸæ­£åœ°ç‹¬ç«‹å¼€å‘ä¸ç‹¬ç«‹éƒ¨ç½²ï¼š

![image](https://user-images.githubusercontent.com/5803001/43637055-609be510-9746-11e8-9e67-da452dd08b74.png)

è¿è¡Œæ—¶ç»„åˆä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©åœ¨ä½¿ç”¨ Tailor è¿™æ ·çš„å·¥å…·è¿›è¡ŒæœåŠ¡ç«¯ç»„åˆ(SSI)ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ JSPM, SystemJS è¿™æ ·çš„åŠ¨æ€å¯¼å…¥å·¥å…·ï¼Œè¿›è¡Œå®¢æˆ·ç«¯ç»„åˆã€‚è¿è¡Œæ—¶ç»„åˆåŒæ—¶èƒ½æä¾›æŒ‰éœ€åŠ è½½çš„ç‰¹æ€§ï¼Œä¼˜åŒ–é¦–é¡µçš„åŠ è½½é€Ÿåº¦ã€‚ä¸è¿‡è¿è¡Œæ—¶ç»„åˆå¯èƒ½é‡å¤åŠ è½½ä¾èµ–é¡¹ï¼ˆé€šè¿‡æµè§ˆå™¨ç¼“å­˜æˆ– HTTP2 é€‚åº¦è§£å†³ï¼‰ï¼Œå¹¶ä¸”ä¸åŒäº iFrame çš„ç¡¬éš”ç¦»ï¼Œè¿è¡Œæ—¶ç»„åˆä»å¯èƒ½é¢ä¸´éš¾ä»¥é¢„æ–™çš„ç¬¬ä¸‰æ–¹ä¾èµ–å†²çªã€‚

React è¿™æ ·çš„å£°æ˜å¼ç»„ä»¶æ¡†æ¶ï¼Œå¤©ç„¶å°±æ”¯æŒåº”ç”¨çš„ç»„åˆï¼Œæˆ‘ä»¬å¯ä»¥ä¼ å…¥æ¸²æŸ“é”šç‚¹ä»¥è¿›è¡Œåº”ç”¨ç»„åˆï¼Œä¹Ÿå¯ä»¥å°†ä¸åŒæ¡†æ¶çš„åº”ç”¨å°è£…ä¸º Web Componentsã€‚é¦–å…ˆæˆ‘ä»¬å¯ä»¥å°† React åº”ç”¨å®šä¹‰ä¸ºè‡ªå®šä¹‰å…ƒç´ ï¼š

> ğŸ“ å®Œæ•´ä»£ç å‚è€ƒ [fe-boilerplate/micro-frontend](https://github.com/wxyyxc1992/fe-boilerplate)

```js
window.customElements.define(
  'react-app',
  class ReactApp extends HTMLElement {
    ...
    render() {
      render(<App title={this.title} />, this);
    }
    ...
  }
);
```

ç„¶ååœ¨å‰ç«¯ä¸­ç›´æ¥ä½¿ç”¨è¯¥è‡ªå®šä¹‰å…ƒç´ ï¼š

```html
<react-app title="React Separate Running App" />
```

åœ¨å•ä½“åº”ç”¨ä¸­ï¼Œæ¡†æ¶å°†è·¯ç”±æŒ‡å®šåˆ°å¯¹åº”çš„ç»„ä»¶æˆ–è€…å†…éƒ¨æœåŠ¡ä¸­ï¼›è€Œå¾®å‰ç«¯ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å°†åº”ç”¨å†…çš„ç»„ä»¶è°ƒç”¨å˜æˆäº†æ›´ç»†ç²’åº¦çš„åº”ç”¨é—´ç»„ä»¶è°ƒç”¨ï¼Œå³åŸå…ˆæˆ‘ä»¬åªæ˜¯å°†è·¯ç”±åˆ†å‘åˆ°åº”ç”¨çš„ç»„ä»¶æ‰§è¡Œï¼Œç°åœ¨åˆ™éœ€è¦æ ¹æ®è·¯ç”±æ¥æ‰¾åˆ°å¯¹åº”çš„åº”ç”¨ï¼Œå†ç”±åº”ç”¨åˆ†å‘åˆ°å¯¹åº”çš„ç»„ä»¶ä¸Šã€‚å…·ä½“çš„å®è·µä¸­ï¼Œå¯èƒ½å®¿ä¸»åº”ç”¨ä½¿ç”¨ Hash Router å·²ç»å ç”¨äº† Hash æ ‡è®°ä½ï¼Œé‚£ä¹ˆå°±éœ€è¦ä¸ºå­åº”ç”¨æä¾›ä¸“å±çš„æŸ¥è¯¢é”®ï¼Œæ¥è¿›è¡Œå­åº”ç”¨å†…è·³è½¬ã€‚

## åº”ç”¨éš”ç¦»ä¸æ²»ç†

åœ¨ React ä¸­å¯ä»¥ä½¿ç”¨ ErrorBoundaryï¼Œæ¥é™åˆ¶åº”ç”¨å´©æºƒçš„å½±å“ï¼›å¦‚æœæ˜¯è‡ªå®šä¹‰çš„åº”ç”¨åŠ è½½å™¨ï¼Œä¹Ÿå¯ä»¥å®ç° Promise å®¹é”™æ–¹æ¡ˆã€‚Redux å¯ä»¥è€ƒè™‘åœ¨å®¿ä¸»åº”ç”¨åˆ›å»ºç»Ÿä¸€çš„ Storeï¼Œæ¯ä¸ªåº”ç”¨ä¸­æŒ‰ç…§å‘½åç©ºé—´åˆ’åˆ†ä½¿ç”¨å­çŠ¶æ€ç©ºé—´ï¼š

```js
const subConnect = subAppName => (mapStateToProps, mapDispatchToProps) =>
  connect(
    state => mapStateToProps({ ...state[subAppName] }, state),
    mapDispatchToProps
  );
```

å¯¹äº Action å¯ä»¥ä½¿ç”¨å‘½åç©ºé—´å½¢å¼ï¼š

```js
`app/service-name/action`;
```

è€Œå¯¹äºåº”ç”¨æ²»ç†æ–¹é¢ï¼Œ[single-spa](https://single-spa.js.org/) æˆ–è€… [ueact-component](https://github.com/wxyyxc1992/Ueact) éƒ½å®šä¹‰äº†è·¨æ¡†æ¶çš„ç»„ä»¶ç”Ÿå‘½å‘¨æœŸï¼Œè­¬å¦‚åœ¨ single-spa ä¸­ï¼Œå¯ä»¥å°† React ç”Ÿå‘½å‘¨æœŸå½’ä¸€åŒ–ï¼š

```js
const reactLifecycles = singleSpaReact({
  React,
  ReactDOM,
  rootComponent,
  domElementGetter: () => document.getElementById('main-content')
});

export const bootstrap = [reactLifecycles.bootstrap];

export const mount = [reactLifecycles.mount];

export const unmount = [reactLifecycles.unmount];
```

ç„¶åå°†å…¶å¯¼å‡ºä¸ºå•ä¸€åº”ç”¨å¹¶ä¸”å¼‚æ­¥åŠ è½½ï¼š

```js
// src/index.js
import { registerApplication, start } from 'single-spa';

registerApplication(
  // Name of our single-spa application
  'root',
  // Our loading function
  () => import('./root.app.js'),
  // Our activity function
  () => true
);

start();
```

# å¤§å‰ç«¯
